import { useEffect, useState } from "react";
import Button from "./Button";
import axios from "../utils/axios";
import ReviewModal from "./ReviewModal";
import { Rating } from "react-simple-star-rating";
import moment from "moment";

const tooltipArray = ["Terrible", "Bad", "Average", "Great", "Awesome"];
function Reviews({ productId, avgRating }) {
  const [reviews, setReviews] = useState([]);
  const [isOpened, setOpened] = useState(false);

  useEffect(() => {
    (async () => {
      try {
        const response = await axios.get(`/reviews/${productId}`);
        setReviews(response);
      } catch (error) {
        console.error(error);
      }
    })();
  }, [productId]);

  return (
    reviews && (
      <section className="mt-20">
        <div className="px-[50px]">
          <div className="mx-auto w-4/5">
            {reviews.length > 0 && (
              <>
                <div className="my-16"></div>
                <div>
                  <div className="mb-10 flex justify-center items-center">
                    <div className="border-r border-border">
                      <div className="mr-10 flex gap-4">
                        <div className="font-SofiaBold text-primary text-[40px]">
                          {Math.round(avgRating * 10) / 10}
                        </div>
                        <div>
                          <Rating
                            transition={true}
                            size={24}
                            initialValue={Math.round(avgRating * 10) / 10}
                            fillColor="#a16854"
                            SVGclassName={`inline-block`}
                            readonly={true}
                            allowFraction={true}
                          />
                          <div className="text-foreground75 text-sm">
                            Based on {reviews.length}{" "}
                            {reviews.length > 1 ? "reviews" : "review"}
                          </div>
                        </div>
                      </div>
                    </div>
                    <Button
                      onClick={() => setOpened(true)}
                      title="Write a review"
                      className="ml-10 w-36 rounded-full text-sm h-9"
                    />
                    <ReviewModal
                      isOpened={isOpened}
                      setOpened={setOpened}
                      productId={productId}
                    />
                  </div>
                </div>
              </>
            )}
            <div className="border-t border-border">
              {reviews.length > 0 ? (
                <ul role="list" className="mt-20">
                  {reviews.map((review) => (
                    <li key={review._id} className="">
                      <div className="my-10">
                        <div className="flex items-center">
                          <div className="mr-3 relative">
                            <i>
                              <svg
                                version="1.1"
                                xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 600 600"
                                width="40"
                                height="40"
                                fill="#8D99B6"
                              >
                                <title>Abstract user icon</title>
                                <defs>
                                  <clipPath id="circular-border-0.03903691315607927">
                                    <circle cx="300" cy="300" r="250"></circle>
                                  </clipPath>
                                </defs>
                                <circle
                                  cx="300"
                                  cy="300"
                                  r="280"
                                  fill="#CCD2E1"
                                ></circle>
                                <circle cx="300" cy="230" r="100"></circle>
                                <circle
                                  cx="300"
                                  cy="550"
                                  r="190"
                                  clipPath="url(#circular-border-0.03903691315607927)"
                                ></circle>
                              </svg>
                            </i>
                            <i className="absolute top-7 left-7">
                              <svg
                                width="15"
                                viewBox="0 0 15 15"
                                fill="none"
                                xmlns="http://www.w3.org/2000/svg"
                              >
                                <circle
                                  cx="7.5"
                                  cy="7.5"
                                  r="7.5"
                                  fill="#1cc286"
                                ></circle>
                                <path
                                  d="M4 7.22222L6.72269 10L11.5 5.5"
                                  stroke="white"
                                  strokeWidth="1.5"
                                ></path>
                              </svg>
                            </i>
                          </div>
                          <div className="pt-1">
                            <p>
                              {review.userId.lastName} {review.userId.firstName}
                            </p>
                            <p className="text-xs text-foreground75">
                              Verified Buyer
                            </p>
                          </div>
                        </div>
                        <div className="text-right text-foreground75 text-sm">
                          {moment(review.createdAt).format("ll")}
                        </div>
                        <div className="flex items-center gap-3">
                          <Rating
                            transition={true}
                            size={20}
                            initialValue={review.rating}
                            fillColor="#a16854"
                            SVGclassName={`inline-block`}
                            readonly={true}
                            allowFraction={true}
                          />
                          <div className="pt-1 ">
                            {tooltipArray[review.rating - 1]}
                          </div>
                        </div>
                        <div className="mt-4 text-foreground75">
                          {review.content}
                        </div>
                      </div>
                      <div className="mt-3 flex justify-end items-center gap-3">
                        Was this review helpful?
                        <div className="flex gap-3">
                          <div className="flex gap-2 items-center">
                            <i>
                              <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="14"
                                height="13"
                                viewBox="0 0 14 13"
                              >
                                <path
                                  d="M8.65454 4.68473H12.7273C13.0648 4.68473 13.3885 4.81882 13.6272 5.0575C13.8659 5.29619 14 5.61991 14 5.95746V7.29637C14.0002 7.46269 13.9677 7.62743 13.9045 7.78128L11.935 12.5635C11.887 12.6801 11.8054 12.7798 11.7005 12.85C11.5957 12.9201 11.4725 12.9575 11.3464 12.9575H0.636364C0.467589 12.9575 0.305728 12.8904 0.186387 12.7711C0.0670452 12.6517 0 12.4899 0 12.3211V5.95746C0 5.78868 0.0670452 5.62682 0.186387 5.50748C0.305728 5.38814 0.467589 5.32109 0.636364 5.32109H2.85218C2.95406 5.32112 3.05446 5.29668 3.14493 5.24984C3.2354 5.203 3.31331 5.13512 3.37209 5.05191L6.84218 0.134731C6.88605 0.0725664 6.95074 0.0281786 7.02452 0.00961572C7.09831 -0.00894717 7.1763 -0.000456173 7.24436 0.0335492L8.39873 0.610731C8.72359 0.773107 8.98312 1.04175 9.13419 1.37202C9.28526 1.7023 9.31878 2.07432 9.22918 2.42628L8.65454 4.68473ZM3.81818 6.33164V11.6847H10.92L12.7273 7.29637V5.95746H8.65454C8.46071 5.95743 8.26944 5.91313 8.09533 5.82793C7.92122 5.74273 7.76887 5.61889 7.6499 5.46586C7.53093 5.31282 7.4485 5.13464 7.40887 4.94489C7.36925 4.75515 7.37349 4.55886 7.42127 4.371L7.99591 2.11319C8.01389 2.04276 8.00722 1.96829 7.977 1.90219C7.94678 1.83608 7.89484 1.78231 7.82982 1.74982L7.40918 1.53982L4.41191 5.78564C4.25282 6.01091 4.04918 6.19546 3.81818 6.33164ZM2.54545 6.59382H1.27273V11.6847H2.54545V6.59382Z"
                                  fill="#2c2c2c"
                                ></path>
                              </svg>
                            </i>
                            {review.likes}
                          </div>
                          <div className="flex gap-2 items-center">
                            <i>
                              <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="14"
                                height="13"
                                viewBox="0 0 14 13"
                              >
                                <path
                                  d="M5.34545 8.27273H1.27273C0.93518 8.27273 0.611456 8.13864 0.372774 7.89995C0.134091 7.66127 6.77279e-07 7.33755 6.77279e-07 7V5.66109C-0.000170899 5.49477 0.0322586 5.33003 0.0954552 5.17618L2.06564 0.394545C2.11354 0.277934 2.19501 0.178179 2.29969 0.107935C2.40438 0.0376913 2.52757 0.00012439 2.65364 0H13.3636C13.5324 0 13.6943 0.0670452 13.8136 0.186387C13.933 0.305728 14 0.467589 14 0.636364V7C14 7.16877 13.933 7.33063 13.8136 7.44998C13.6943 7.56932 13.5324 7.63636 13.3636 7.63636H11.1478C11.0459 7.63634 10.9455 7.66077 10.8551 7.70761C10.7646 7.75446 10.6867 7.82234 10.6279 7.90554L7.15782 12.8221C7.11395 12.8843 7.04926 12.9286 6.97548 12.9472C6.90169 12.9658 6.8237 12.9573 6.75564 12.9233L5.60127 12.3455C5.27641 12.1831 5.01688 11.9144 4.86581 11.5842C4.71474 11.2539 4.68122 10.8819 4.77082 10.5299L5.34545 8.27273ZM10.1818 6.62582V1.27273H3.08L1.27273 5.66109V7H5.34545C5.53929 7.00003 5.73056 7.04433 5.90467 7.12953C6.07878 7.21472 6.23113 7.33856 6.3501 7.4916C6.46906 7.64463 6.5515 7.82282 6.59113 8.01257C6.63075 8.20231 6.62651 8.3986 6.57873 8.58645L6.00409 10.8443C5.98611 10.9147 5.99278 10.9892 6.023 11.0553C6.05321 11.1214 6.10516 11.1751 6.17018 11.2076L6.59082 11.4176L9.58809 7.17182C9.74718 6.94655 9.95082 6.762 10.1818 6.62582ZM11.4545 6.36364H12.7273V1.27273H11.4545V6.36364Z"
                                  fill="#2c2c2c"
                                ></path>
                              </svg>
                            </i>
                            {review.likes}
                          </div>
                        </div>
                      </div>
                      <div className="mt-3 border-b border-border"></div>
                    </li>
                  ))}
                </ul>
              ) : (
                <div className="my-20 flex flex-col justify-center">
                  <div className="text-center">
                    <i className="flex justify-center">
                      <svg
                        width="55"
                        height="55"
                        viewBox="0 0 55 55"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <g clipPath="url(#clip0)">
                          <path
                            d="M38.813 9.20323L13.2319 34.7843C14.1962 33.82 15.7597 33.82 16.724 34.7843C17.6883 35.7486 17.6883 37.3121 16.724 38.2764L25.3177 29.6826C26.282 28.7183 27.8455 28.7183 28.8098 29.6826C29.7741 30.6469 29.7741 32.2104 28.8098 33.1747L45.8882 16.0963L38.813 9.20323Z"
                            fill="#FFF5D7"
                          ></path>
                          <path
                            d="M34.9385 36.4658C35.7811 35.6232 37.1473 35.6232 37.9895 36.4658C38.8124 37.2882 38.8254 38.6063 38.0415 39.4526L35.912 41.586C36.7542 40.7434 38.1204 40.7434 38.963 41.586C39.7905 42.413 39.8006 43.7424 39.0029 44.5879L51.7261 31.8647L45.9878 25.3988L34.9385 36.4658Z"
                            fill="#FFF5D7"
                          ></path>
                          <path
                            d="M8.16602 18.0595C9.00861 17.217 10.3745 17.217 11.217 18.0595C12.0399 18.882 12.0529 20.2 11.2691 21.0464L9.13911 23.1793C9.9817 22.3371 11.348 22.3371 12.1901 23.1793C13.0176 24.0068 13.0277 25.3361 12.2304 26.1816L24.9536 13.4584L19.2149 6.99257L8.16602 18.0595Z"
                            fill="#FFF5D7"
                          ></path>
                          <path
                            d="M40.237 1.69043L41.0145 6.3679C41.0775 6.74597 40.8865 7.12069 40.5437 7.29189L36.3026 9.4118C35.0379 10.0442 35.3367 11.9278 36.7344 12.138L41.4232 12.8434C41.8021 12.9005 42.0996 13.198 42.1563 13.5769L42.4941 15.8189L42.915 18.1365C43.1252 19.5346 44.682 18.9178 45.3139 17.6531L47.4447 14.1262C47.6159 13.7834 48.2839 13.365 48.662 13.4279L53.1737 14.529C54.5681 14.7611 54.6642 13.856 53.6571 12.864L50.6493 9.26535C50.3762 8.99638 50.1235 7.64479 50.3002 7.3049L52.8783 3.75998C53.5296 2.50532 52.6555 2.19523 51.4013 2.84689L49.4715 2.71933L47.0473 3.97818C46.707 4.15484 46.2916 4.08896 46.0231 3.81621L42.6959 0.437454C41.7044 -0.570046 40.0049 0.295624 40.237 1.69043Z"
                            fill="#FFE07D"
                          ></path>
                          <path
                            d="M39.7229 16.1499C39.7229 16.3731 39.6377 16.5968 39.4674 16.7671L1.49135 54.7432C1.1502 55.0843 0.597565 55.0843 0.256837 54.7432C-0.0843103 54.402 -0.0843103 53.8498 0.256837 53.5087L38.2329 15.5326C38.574 15.1915 39.1262 15.1915 39.4674 15.5326C39.6377 15.703 39.7229 15.9266 39.7229 16.1499Z"
                            fill="#FFEAA8"
                          ></path>
                          <path
                            d="M34.0476 14.8407C34.0476 15.0639 33.9624 15.2876 33.7916 15.4579L10.6569 38.5931C10.3157 38.9338 9.76351 38.9338 9.42237 38.5931C9.08122 38.2519 9.08122 37.6993 9.42237 37.3586L32.5575 14.2234C32.8982 13.8823 33.4509 13.8823 33.7916 14.2234C33.9624 14.3938 34.0476 14.6174 34.0476 14.8407Z"
                            fill="#FFEAA8"
                          ></path>
                          <path
                            d="M17.4601 15.7144C17.4601 15.9376 17.375 16.1609 17.2046 16.3317L1.49037 32.0459C1.14922 32.387 0.59659 32.387 0.255861 32.0459C-0.0852871 31.7047 -0.0852871 31.1525 0.255861 30.8114L15.9701 15.0972C16.3112 14.756 16.8634 14.756 17.2046 15.0972C17.375 15.2675 17.4601 15.4908 17.4601 15.7144Z"
                            fill="#FFEAA8"
                          ></path>
                          <path
                            d="M12.6584 14.4043C12.6584 14.6275 12.5733 14.8512 12.4029 15.0216L7.60121 19.8232C7.26007 20.1644 6.70785 20.1644 6.3667 19.8232C6.02555 19.4821 6.02555 18.9299 6.3667 18.5887L11.1684 13.7871C11.5095 13.4459 12.0617 13.4459 12.4029 13.7871C12.5733 13.9574 12.6584 14.1811 12.6584 14.4043Z"
                            fill="#FFEAA8"
                          ></path>
                          <path
                            d="M19.2063 20.0791C19.2063 20.3024 19.1211 20.526 18.9507 20.6964L11.0934 28.5537C10.7523 28.8949 10.2 28.8949 9.85889 28.5537C9.51774 28.2126 9.51774 27.6603 9.85889 27.3192L17.7162 19.4619C18.0574 19.1207 18.6096 19.1207 18.9507 19.4619C19.1211 19.6327 19.2063 19.8559 19.2063 20.0791Z"
                            fill="#FFEAA8"
                          ></path>
                          <path
                            d="M45.117 24.603L45.6562 27.8458L42.7159 29.3157C41.9443 29.7013 42.1264 30.8511 42.9795 30.9795L46.2298 31.4683L46.4019 32.6101L46.8714 34.5722C46.9998 35.4253 47.8285 35.3083 48.2142 34.5366L49.8435 31.7256L52.9768 32.227C53.8278 32.3684 54.0389 31.8116 53.4246 31.2065L51.3475 28.8432L52.7263 25.7993C53.1237 25.0339 52.7041 24.5782 51.9383 24.976L50.5749 25.3235L48.9246 26.1808L46.618 23.8385C46.0124 23.2237 44.9756 23.752 45.117 24.603Z"
                            fill="#FFE07D"
                          ></path>
                          <path
                            d="M41.0317 21.8255C41.0317 22.0492 40.9465 22.2724 40.7761 22.4428L25.9347 37.2842C25.5936 37.6253 25.0413 37.6253 24.7002 37.2842C24.359 36.943 24.359 36.3908 24.7002 36.0497L39.5416 21.2083C39.8824 20.8675 40.435 20.8675 40.7761 21.2083C40.9465 21.379 41.0317 21.6023 41.0317 21.8255Z"
                            fill="#FFEAA8"
                          ></path>
                          <path
                            d="M49.4719 2.71848C49.6557 3.53001 49.7618 4.37051 49.7618 5.23785C49.7618 10.0651 46.7427 14.1778 42.4937 15.8181L42.8621 18.2653C43.0723 19.663 44.9564 19.9613 45.5883 18.697L47.7082 14.4556C47.8794 14.1132 48.2546 13.9218 48.6322 13.9848L53.3101 14.7627C54.7045 14.9944 55.5702 13.2949 54.5631 12.3034L51.1843 8.97663C50.9112 8.70766 50.8457 8.29224 51.0219 7.95193L53.2073 3.7436C53.859 2.48937 52.5103 1.14072 51.2557 1.79196L49.4719 2.71848Z"
                            fill="#FFD064"
                          ></path>
                          <path
                            d="M51.8418 24.6651L50.5754 25.3226C50.6106 25.6076 50.6349 25.8954 50.6349 26.19C50.6349 29.0698 48.8906 31.5414 46.4019 32.6093L46.7195 34.7183C46.8475 35.5714 47.9972 35.7535 48.3829 34.9818L49.8528 32.0416L53.0956 32.5808C53.9466 32.7222 54.4749 31.6853 53.8601 31.0798L51.5178 28.7736L53.0326 25.856C53.4304 25.0906 52.6071 24.2673 51.8418 24.6651Z"
                            fill="#FFD064"
                          ></path>
                          <path
                            d="M18.35 6.08718L18.8892 9.32997L15.949 10.7999C15.1773 11.1855 15.359 12.3349 16.2125 12.4633L19.4629 12.9525L19.6345 14.0943L20.0612 16.0862C20.1896 16.9393 21.1258 16.8848 21.5114 16.1131L22.9885 13.2664L26.2648 13.8304C27.1158 13.9718 27.363 13.3075 26.7482 12.7024L24.385 10.4734L25.9963 7.43876C26.3941 6.67296 25.849 5.9936 25.0832 6.3914L23.8088 6.80724L22.1572 7.66493L19.8506 5.32263C19.2455 4.70789 18.2082 5.23619 18.35 6.08718Z"
                            fill="#FFE07D"
                          ></path>
                          <path
                            d="M25.0743 6.15047L23.8083 6.80801C23.8435 7.09251 23.8674 7.38078 23.8674 7.67535C23.8674 10.5552 22.1235 13.0267 19.6348 14.0946L19.952 16.2036C20.0804 17.0567 21.2301 17.2388 21.6158 16.4672L23.0857 13.5269L26.3285 14.0661C27.1795 14.2075 27.7078 13.1702 27.093 12.5651L24.7507 10.2585L26.2655 7.34134C26.6629 6.57596 25.8401 5.75267 25.0743 6.15047Z"
                            fill="#FFD064"
                          ></path>
                          <path
                            d="M44.1579 34.232C44.1579 34.4556 44.0727 34.6789 43.9023 34.8492L28.1881 50.5635C27.847 50.9046 27.2948 50.9046 26.9536 50.5635C26.6125 50.2227 26.6125 49.6701 26.9536 49.3294L42.6678 33.6147C43.009 33.274 43.5612 33.274 43.9023 33.6147C44.0727 33.7855 44.1579 34.0088 44.1579 34.232Z"
                            fill="#FFEAA8"
                          ></path>
                          <path
                            d="M39.3568 32.9233C39.3568 33.1465 39.2712 33.3698 39.1008 33.5405L34.2991 38.3418C33.9584 38.6829 33.4058 38.6829 33.0646 38.3418C32.7239 38.0011 32.7239 37.4484 33.0646 37.1073L37.8663 32.306C38.2075 31.9649 38.7597 31.9649 39.1008 32.306C39.2716 32.4764 39.3568 32.6996 39.3568 32.9233Z"
                            fill="#FFEAA8"
                          ></path>
                          <path
                            d="M45.9041 38.5971C45.9041 38.8204 45.8185 39.044 45.6482 39.2144L37.7908 47.0713C37.4501 47.4124 36.8975 47.4124 36.5563 47.0713C36.2156 46.7306 36.2156 46.1779 36.5563 45.8368L44.4137 37.9799C44.7548 37.6387 45.307 37.6387 45.6482 37.9799C45.8185 38.1502 45.9041 38.3739 45.9041 38.5971Z"
                            fill="#FFEAA8"
                          ></path>
                        </g>
                        <defs>
                          <clipPath id="clip0">
                            <rect
                              width="55"
                              height="55"
                              fill="white"
                              transform="translate(0 55) rotate(-90)"
                            ></rect>
                          </clipPath>
                        </defs>
                      </svg>
                    </i>
                    <div className="font-SofiaBold mt-3 text-lg">
                      Weâ€™re looking for feedback!
                    </div>
                    <div className="mt-4">Let us know what you think</div>
                    <Button
                      title="Be the first to write a review!"
                      onClick={() => setOpened(true)}
                      className="w-72 px-4 rounded-full text-sm h-9 mt-4"
                    />
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>
      </section>
    )
  );
}

export default Reviews;
